# CFC V7.7 é¡¹ç›®æ¶æ„å…¨æ™¯å›¾

> **ç”Ÿæˆæ—¶é—´**: 2025-12-13  
> **æ¡†æ¶ç‰ˆæœ¬**: CFC V7.7  
> **é¡¹ç›®åç§°**: CRM_AI_V7  
> **å®¡è®¡æ ‡å‡†**: CFC Constitution "ä¸ƒå®—ç½ª" (Seven Deadly Sins)

---

## ğŸ“ é¡¹ç›®å®Œæ•´ç›®å½•ç»“æ„

```
CRM_AI_V7/
â”œâ”€â”€ ğŸ“„ .env                          # ç¯å¢ƒé…ç½®ï¼ˆæ•æ„Ÿä¿¡æ¯ï¼‰
â”œâ”€â”€ ğŸ“„ .env.example                  # ç¯å¢ƒé…ç½®æ¨¡æ¿
â”œâ”€â”€ ğŸ“„ README.md                     # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ ğŸ“„ SYSTEM_AUDIT_REPORT_V7.7.md   # ç³»ç»Ÿå®¡è®¡æŠ¥å‘Š
â”œâ”€â”€ ğŸ“„ VALIDATION_REPORT.md          # éªŒè¯æŠ¥å‘Š
â”‚
â”œâ”€â”€ ğŸ“‚ .github/                      # GitHub é…ç½®
â”‚   â””â”€â”€ ğŸ“„ copilot-instructions.md   # AI ç¼–ç æŒ‡å—
â”‚
â”œâ”€â”€ ğŸ“‚ config/                       # å¤–éƒ¨é…ç½®
â”‚   â”œâ”€â”€ ğŸ“„ ai_debate.conf            # AI è¾©è®ºé…ç½®
â”‚   â”œâ”€â”€ ğŸ“„ debate_agents.php         # Agent é…ç½®
â”‚   â””â”€â”€ ğŸ“„ nginx_ai_debate.conf      # Nginx é…ç½®
â”‚
â”œâ”€â”€ ğŸ“‚ database/                     # æ•°æ®åº“è„šæœ¬
â”‚   â”œâ”€â”€ ğŸ“„ schema.sql                # ä¸»è¡¨ç»“æ„
â”‚   â”œâ”€â”€ ğŸ“„ cuige_chat.sql            # å´”å“¥èŠå¤©è¡¨
â”‚   â”œâ”€â”€ ğŸ“„ cuige_memory_v2.sql       # è®°å¿†ç³»ç»Ÿ V2
â”‚   â”œâ”€â”€ ğŸ“„ cuige_memory_v3.sql       # è®°å¿†ç³»ç»Ÿ V3
â”‚   â”œâ”€â”€ ğŸ“„ cuige_memory_v3_fixed.sql # è®°å¿†ç³»ç»Ÿä¿®å¤
â”‚   â”œâ”€â”€ ğŸ“„ cuige_tasks.sql           # ä»»åŠ¡è¡¨
â”‚   â””â”€â”€ ğŸ“„ ...                       # å…¶ä»–è¿ç§»è„šæœ¬
â”‚
â”œâ”€â”€ ğŸ“‚ docs/                         # æ–‡æ¡£
â”‚   â”œâ”€â”€ ğŸ“„ CFC_V7.7_Framework_Evaluation.md
â”‚   â”œâ”€â”€ ğŸ“„ CFC-V7.6.md
â”‚   â”œâ”€â”€ ğŸ“„ CLAUDE.md
â”‚   â”œâ”€â”€ ğŸ“„ DEBATE_GUIDE.md
â”‚   â”œâ”€â”€ ğŸ“„ INSTALL.md
â”‚   â””â”€â”€ ğŸ“„ ...
â”‚
â”œâ”€â”€ ğŸ“‚ examples/                     # ç¤ºä¾‹ä»£ç 
â”‚   â”œâ”€â”€ ğŸ“„ 00_quickstart.php
â”‚   â”œâ”€â”€ ğŸ“„ 01_basic_usage.php
â”‚   â”œâ”€â”€ ğŸ“„ 02_tool_usage.php
â”‚   â”œâ”€â”€ ğŸ“„ 03_task_execution.php
â”‚   â”œâ”€â”€ ğŸ“„ 04_queue_processing.php
â”‚   â””â”€â”€ ğŸ“„ 05_cost_tracking.php
â”‚
â”œâ”€â”€ ğŸ“‚ logs/                         # æ—¥å¿—ç›®å½•
â”‚
â”œâ”€â”€ ğŸ“‚ public/                       # ğŸ”´ Web å…¥å£ç›®å½•
â”‚   â”œâ”€â”€ ğŸ“„ index.php     âœ…           # å”¯ä¸€åˆæ³• HTTP å…¥å£
â”‚   â”œâ”€â”€ ğŸ“„ index.html                # å‰ç«¯é¦–é¡µ
â”‚   â”œâ”€â”€ ğŸ“„ cuige.html                # å´”å“¥ AI ç•Œé¢
â”‚   â””â”€â”€ ğŸ“„ rag.html                  # RAG çŸ¥è¯†åº“ç•Œé¢
â”‚
â”œâ”€â”€ ğŸ“‚ src/                          # ğŸ—ï¸ æ ¸å¿ƒæºç ç›®å½•
â”‚   â”œâ”€â”€ ğŸ“„ CFCV7.0.md                # æ¡†æ¶è§„èŒƒæ–‡æ¡£
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“‚ Bootstrap/                # ğŸš€ å¯åŠ¨å±‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ App.php      âœ…       # æ¡†æ¶å¯åŠ¨å™¨
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ Router.php   âœ…       # RESTful è·¯ç”±å™¨
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ routes.php   âœ…       # è·¯ç”±é…ç½® + IoC å®¹å™¨
â”‚   â”‚   â””â”€â”€ ğŸ“„ migrate.php  âš ï¸       # æ•°æ®åº“è¿ç§» (CLI)
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“‚ Config/                   # âš™ï¸ é…ç½®å±‚
â”‚   â”‚   â””â”€â”€ ğŸ“„ agents.php            # Agent é…ç½®
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“‚ Controllers/              # ğŸ® æ§åˆ¶å™¨å±‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ CuigeController.php   âœ… # å´”å“¥ AI æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ DebateController.php  âŒ # è¾©è®ºæ§åˆ¶å™¨ (æœ‰è¿è§„)
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ RagController.php     âœ… # RAG çŸ¥è¯†åº“æ§åˆ¶å™¨
â”‚   â”‚   â””â”€â”€ ğŸ“„ SystemController.php  âœ… # ç³»ç»Ÿæ§åˆ¶å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“‚ Core/                     # ğŸ’ æ ¸å¿ƒå±‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ Request.php  âœ…       # HTTP è¯·æ±‚å°è£…
â”‚   â”‚   â””â”€â”€ ğŸ“„ Response.php âœ…       # HTTP å“åº”å°è£…
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“‚ Services/                 # ğŸ”§ æœåŠ¡å±‚
â”‚       â””â”€â”€ ğŸ“‚ AI/                   # AI æœåŠ¡æ¨¡å—
â”‚           â”œâ”€â”€ ğŸ“„ Bootstrap.php     # AI ç³»ç»Ÿå¼•å¯¼
â”‚           â”œâ”€â”€ ğŸ“„ Config.php        # AI é…ç½®ç®¡ç†
â”‚           â”‚
â”‚           â”œâ”€â”€ ğŸ“‚ Analytics/        # ğŸ“Š åˆ†ææ¨¡å—
â”‚           â”‚   â”œâ”€â”€ ğŸ“„ CostCalculator.php   # æˆæœ¬è®¡ç®—
â”‚           â”‚   â””â”€â”€ ğŸ“„ UsageTracker.php     # ä½¿ç”¨è¿½è¸ª
â”‚           â”‚
â”‚           â”œâ”€â”€ ğŸ“‚ Core/             # ğŸ§  AI æ ¸å¿ƒ
â”‚           â”‚   â”œâ”€â”€ ğŸ“„ AIManager.php        # AI ç®¡ç†å™¨
â”‚           â”‚   â”œâ”€â”€ ğŸ“„ ModelRouter.php      # æ¨¡å‹è·¯ç”±
â”‚           â”‚   â”œâ”€â”€ ğŸ“„ SSEResponse.php âš ï¸   # SSE å“åº” (æ¡†æ¶å±‚)
â”‚           â”‚   â”‚
â”‚           â”‚   â”œâ”€â”€ ğŸ“‚ RAG/                 # RAG å‘é‡æ£€ç´¢
â”‚           â”‚   â”‚   â”œâ”€â”€ ğŸ“„ DocumentChunker.php  # æ–‡æ¡£åˆ†å—
â”‚           â”‚   â”‚   â”œâ”€â”€ ğŸ“„ EmbeddingEngine.php  # åµŒå…¥å¼•æ“
â”‚           â”‚   â”‚   â”œâ”€â”€ ğŸ“„ LocalEmbedding.php   # æœ¬åœ°åµŒå…¥
â”‚           â”‚   â”‚   â””â”€â”€ ğŸ“„ VectorService.php    # å‘é‡æœåŠ¡
â”‚           â”‚   â”‚
â”‚           â”‚   â””â”€â”€ ğŸ“‚ Utils/               # å·¥å…·ç±»
â”‚           â”‚       â”œâ”€â”€ ğŸ“„ FunctionCaller.php   # å‡½æ•°è°ƒç”¨
â”‚           â”‚       â”œâ”€â”€ ğŸ“„ StreamHandler.php    # æµå¤„ç†
â”‚           â”‚       â””â”€â”€ ğŸ“„ TokenCounter.php     # Token è®¡æ•°
â”‚           â”‚
â”‚           â”œâ”€â”€ ğŸ“‚ Cuige/            # ğŸ¤– å´”å“¥ AI æ¨¡å—
â”‚           â”‚   â”œâ”€â”€ ğŸ“„ CuigeConfig.php      # å´”å“¥é…ç½®
â”‚           â”‚   â”œâ”€â”€ ğŸ“„ CuigeRepository.php  # å´”å“¥æ•°æ®è®¿é—®
â”‚           â”‚   â””â”€â”€ ğŸ“„ CuigeService.php     # å´”å“¥æ ¸å¿ƒæœåŠ¡
â”‚           â”‚
â”‚           â”œâ”€â”€ ğŸ“‚ Debate/           # ğŸ¤ è¾©è®ºæ¨¡å—
â”‚           â”‚   â””â”€â”€ ğŸ“„ DebateService.php    # è¾©è®ºæœåŠ¡
â”‚           â”‚
â”‚           â”œâ”€â”€ ğŸ“‚ Document/         # ğŸ“„ æ–‡æ¡£å¤„ç†æ¨¡å—
â”‚           â”‚   â”œâ”€â”€ ğŸ“„ SmartDocumentProcessor.php  # æ™ºèƒ½æ–‡æ¡£å¤„ç†
â”‚           â”‚   â””â”€â”€ ğŸ“„ TableExtractor.php         # è¡¨æ ¼æå–
â”‚           â”‚
â”‚           â”œâ”€â”€ ğŸ“‚ Memory/           # ğŸ§  è®°å¿†æ¨¡å—
â”‚           â”‚   â”œâ”€â”€ ğŸ“„ ContextManager.php       # ä¸Šä¸‹æ–‡ç®¡ç†
â”‚           â”‚   â”œâ”€â”€ ğŸ“„ CuigeMemoryEngine.php    # å´”å“¥è®°å¿†å¼•æ“
â”‚           â”‚   â”œâ”€â”€ ğŸ“„ ShortTerm.php            # çŸ­æœŸè®°å¿†
â”‚           â”‚   â”œâ”€â”€ ğŸ“„ Summary.php              # æ‘˜è¦ç”Ÿæˆ
â”‚           â”‚   â””â”€â”€ ğŸ“„ VectorStore.php          # å‘é‡å­˜å‚¨
â”‚           â”‚
â”‚           â”œâ”€â”€ ğŸ“‚ Pipeline/         # ğŸ”„ ç®¡é“æ¨¡å—
â”‚           â”‚   â”œâ”€â”€ ğŸ“„ Pipeline.php             # ç®¡é“æ ¸å¿ƒ
â”‚           â”‚   â”œâ”€â”€ ğŸ“„ PipelineContext.php      # ç®¡é“ä¸Šä¸‹æ–‡
â”‚           â”‚   â”‚
â”‚           â”‚   â””â”€â”€ ğŸ“‚ Pipes/                   # ç®¡é“æ­¥éª¤
â”‚           â”‚       â”œâ”€â”€ ğŸ“„ CallModel.php        # è°ƒç”¨æ¨¡å‹
â”‚           â”‚       â”œâ”€â”€ ğŸ“„ ExecuteTool.php      # æ‰§è¡Œå·¥å…·
â”‚           â”‚       â”œâ”€â”€ ğŸ“„ FormatOutput.php     # æ ¼å¼åŒ–è¾“å‡º
â”‚           â”‚       â”œâ”€â”€ ğŸ“„ LoadMemory.php       # åŠ è½½è®°å¿†
â”‚           â”‚       â”œâ”€â”€ ğŸ“„ PlanTools.php        # è§„åˆ’å·¥å…·
â”‚           â”‚       â”œâ”€â”€ ğŸ“„ RateLimit.php        # é™æµ
â”‚           â”‚       â”œâ”€â”€ ğŸ“„ SafetyCheck.php      # å®‰å…¨æ£€æŸ¥
â”‚           â”‚       â””â”€â”€ ğŸ“„ SaveMemory.php       # ä¿å­˜è®°å¿†
â”‚           â”‚
â”‚           â”œâ”€â”€ ğŸ“‚ Prompts/          # ğŸ’¬ æç¤ºè¯æ¨¡å—
â”‚           â”‚   â”œâ”€â”€ ğŸ“„ TemplateManager.php      # æ¨¡æ¿ç®¡ç†
â”‚           â”‚   â””â”€â”€ ğŸ“‚ templates/               # æ¨¡æ¿ç›®å½• (ç©º)
â”‚           â”‚
â”‚           â”œâ”€â”€ ğŸ“‚ Providers/        # ğŸ”Œ AI æä¾›å•†
â”‚           â”‚   â”œâ”€â”€ ğŸ“„ AbstractProvider.php     # æŠ½è±¡åŸºç±»
â”‚           â”‚   â”œâ”€â”€ ğŸ“„ ProviderInterface.php    # æ¥å£å®šä¹‰
â”‚           â”‚   â”œâ”€â”€ ğŸ“„ DeepseekProvider.php     # DeepSeek
â”‚           â”‚   â”œâ”€â”€ ğŸ“„ OpenAIProvider.php       # OpenAI
â”‚           â”‚   â”œâ”€â”€ ğŸ“„ RelayProvider.php        # ä¸­ç»§ä»£ç†
â”‚           â”‚   â””â”€â”€ ğŸ“„ EmbeddingProvider.php    # åµŒå…¥æœåŠ¡
â”‚           â”‚
â”‚           â”œâ”€â”€ ğŸ“‚ Queue/            # ğŸ“‹ é˜Ÿåˆ—æ¨¡å—
â”‚           â”‚   â”œâ”€â”€ ğŸ“„ AIJobDispatcher.php      # ä»»åŠ¡åˆ†å‘
â”‚           â”‚   â”œâ”€â”€ ğŸ“„ AIJobWorker.php          # ä»»åŠ¡æ‰§è¡Œ
â”‚           â”‚   â”œâ”€â”€ ğŸ“„ DeadLetterQueue.php      # æ­»ä¿¡é˜Ÿåˆ—
â”‚           â”‚   â”‚
â”‚           â”‚   â””â”€â”€ ğŸ“‚ Jobs/                    # ä»»åŠ¡å®šä¹‰
â”‚           â”‚       â”œâ”€â”€ ğŸ“„ RunAgentJob.php      # è¿è¡ŒAgent
â”‚           â”‚       â””â”€â”€ ğŸ“„ VectorizeDocJob.php  # æ–‡æ¡£å‘é‡åŒ–
â”‚           â”‚
â”‚           â”œâ”€â”€ ğŸ“‚ Tasks/            # ğŸ“ ä»»åŠ¡æ¨¡å—
â”‚           â”‚   â”œâ”€â”€ ğŸ“„ BaseTask.php             # ä»»åŠ¡åŸºç±»
â”‚           â”‚   â”œâ”€â”€ ğŸ“„ ContractReview.php       # åˆåŒå®¡æ ¸
â”‚           â”‚   â”œâ”€â”€ ğŸ“„ DebateAgent.php          # è¾©è®ºAgent
â”‚           â”‚   â”œâ”€â”€ ğŸ“„ GeneralAgent.php         # é€šç”¨Agent
â”‚           â”‚   â””â”€â”€ ğŸ“„ WorktimeEstimate.php     # å·¥æ—¶ä¼°ç®—
â”‚           â”‚
â”‚           â”œâ”€â”€ ğŸ“‚ Tools/            # ğŸ› ï¸ å·¥å…·æ¨¡å—
â”‚           â”‚   â”œâ”€â”€ ğŸ“„ BaseTool.php             # å·¥å…·åŸºç±»
â”‚           â”‚   â”œâ”€â”€ ğŸ“„ ToolRegistry.php         # å·¥å…·æ³¨å†Œ
â”‚           â”‚   â”œâ”€â”€ ğŸ“„ ToolSandbox.php          # å·¥å…·æ²™ç®±
â”‚           â”‚   â”‚
â”‚           â”‚   â”œâ”€â”€ ğŸ“‚ Business/               # ä¸šåŠ¡å·¥å…·
â”‚           â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ContractFinder.php   # åˆåŒæŸ¥æ‰¾
â”‚           â”‚   â”‚   â”œâ”€â”€ ğŸ“„ EmailSender.php      # é‚®ä»¶å‘é€
â”‚           â”‚   â”‚   â””â”€â”€ ğŸ“„ ReportBuilder.php    # æŠ¥è¡¨ç”Ÿæˆ
â”‚           â”‚   â”‚
â”‚           â”‚   â””â”€â”€ ğŸ“‚ System/                 # ç³»ç»Ÿå·¥å…·
â”‚           â”‚       â”œâ”€â”€ ğŸ“„ DatabaseReader.php   # æ•°æ®åº“è¯»å–
â”‚           â”‚       â”œâ”€â”€ ğŸ“„ HttpSearch.php       # HTTP æœç´¢
â”‚           â”‚       â””â”€â”€ ğŸ“„ TimeCalculator.php   # æ—¶é—´è®¡ç®—
â”‚           â”‚
â”‚           â””â”€â”€ ğŸ“‚ Vision/           # ğŸ‘ï¸ è§†è§‰æ¨¡å—
â”‚               â””â”€â”€ ğŸ“„ ImageAnalyzer.php       # å›¾ç‰‡åˆ†æ
â”‚
â”œâ”€â”€ ğŸ“‚ tests/                        # ğŸ§ª æµ‹è¯•ç›®å½•
â”‚   â”œâ”€â”€ ğŸ“„ debug_test.php
â”‚   â”œâ”€â”€ ğŸ“„ demo_multi_agent.php
â”‚   â”œâ”€â”€ ğŸ“„ full_test.php
â”‚   â”œâ”€â”€ ğŸ“„ test_*.php               # å„ç±»æµ‹è¯•æ–‡ä»¶ (40+)
â”‚   â””â”€â”€ ğŸ“„ ...
â”‚
â”œâ”€â”€ ğŸ“‚ uploads/                      # ğŸ“¤ ä¸Šä¼ ç›®å½•
â”‚
â”œâ”€â”€ ğŸ“‚ vendor/                       # ğŸ“¦ Composer ä¾èµ–
â”‚
â””â”€â”€ ğŸ“‚ workers/                      # âš™ï¸ åå° Worker
    â”œâ”€â”€ ğŸ“„ memory_worker.php         # è®°å¿† Worker
    â””â”€â”€ ğŸ“„ memory_worker_v3.php      # è®°å¿† Worker V3
```

---

## ğŸ“Š æ–‡ä»¶ç»Ÿè®¡

| ç›®å½• | PHP æ–‡ä»¶æ•° | è¯´æ˜ |
|------|-----------|------|
| `src/Bootstrap/` | 4 | æ¡†æ¶å¯åŠ¨å±‚ |
| `src/Config/` | 1 | é…ç½®æ–‡ä»¶ |
| `src/Controllers/` | 4 | æ§åˆ¶å™¨ |
| `src/Core/` | 2 | æ ¸å¿ƒç±» |
| `src/Services/AI/` | 2 | AI æœåŠ¡å…¥å£ |
| `src/Services/AI/Analytics/` | 2 | åˆ†ææ¨¡å— |
| `src/Services/AI/Core/` | 3 | AI æ ¸å¿ƒ |
| `src/Services/AI/Core/RAG/` | 4 | RAG æ¨¡å— |
| `src/Services/AI/Core/Utils/` | 3 | å·¥å…·ç±» |
| `src/Services/AI/Cuige/` | 3 | å´”å“¥ AI |
| `src/Services/AI/Debate/` | 1 | è¾©è®ºæ¨¡å— |
| `src/Services/AI/Document/` | 2 | æ–‡æ¡£å¤„ç† |
| `src/Services/AI/Memory/` | 5 | è®°å¿†ç³»ç»Ÿ |
| `src/Services/AI/Pipeline/` | 2 | ç®¡é“æ ¸å¿ƒ |
| `src/Services/AI/Pipeline/Pipes/` | 8 | ç®¡é“æ­¥éª¤ |
| `src/Services/AI/Prompts/` | 1 | æç¤ºè¯ç®¡ç† |
| `src/Services/AI/Providers/` | 6 | AI æä¾›å•† |
| `src/Services/AI/Queue/` | 3 | é˜Ÿåˆ—ç³»ç»Ÿ |
| `src/Services/AI/Queue/Jobs/` | 2 | ä»»åŠ¡å®šä¹‰ |
| `src/Services/AI/Tasks/` | 5 | ä»»åŠ¡æ¨¡å— |
| `src/Services/AI/Tools/` | 3 | å·¥å…·æ ¸å¿ƒ |
| `src/Services/AI/Tools/Business/` | 3 | ä¸šåŠ¡å·¥å…· |
| `src/Services/AI/Tools/System/` | 3 | ç³»ç»Ÿå·¥å…· |
| `src/Services/AI/Vision/` | 1 | è§†è§‰æ¨¡å— |
| **src/ æ€»è®¡** | **73** | - |
| `public/` | 1 | Web å…¥å£ |
| `tests/` | 46 | æµ‹è¯•æ–‡ä»¶ |
| `workers/` | 2 | Worker |
| `examples/` | 6 | ç¤ºä¾‹ |

---

## ğŸ”— æ ¸å¿ƒä¾èµ–å…³ç³»å›¾

### 1. HTTP è¯·æ±‚æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        HTTP Request                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  public/index.php (å”¯ä¸€å…¥å£) âœ…                                      â”‚
â”‚  â”œâ”€â”€ require vendor/autoload.php                                     â”‚
â”‚  â”œâ”€â”€ App::boot(APP_ROOT)                                            â”‚
â”‚  â”œâ”€â”€ Request::capture()                                              â”‚
â”‚  â”œâ”€â”€ $router->dispatch($request)                                     â”‚
â”‚  â””â”€â”€ $response->send()                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  src/Bootstrap/App.php                                               â”‚
â”‚  â”œâ”€â”€ åŠ è½½ .env ç¯å¢ƒå˜é‡                                               â”‚
â”‚  â”œâ”€â”€ åˆ›å»º Router å®ä¾‹                                                 â”‚
â”‚  â””â”€â”€ åŠ è½½ routes.php                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  src/Bootstrap/routes.php (IoC å®¹å™¨)                                 â”‚
â”‚  â”œâ”€â”€ Bootstrap::getPgPdo()           # PostgreSQL è¿æ¥               â”‚
â”‚  â”œâ”€â”€ Bootstrap::getPDO()             # MySQL è¿æ¥                    â”‚
â”‚  â”œâ”€â”€ new VectorService($pdo, ...)    # å‘é‡æœåŠ¡                      â”‚
â”‚  â”œâ”€â”€ new SmartDocumentProcessor(...) # æ–‡æ¡£å¤„ç†å™¨                    â”‚
â”‚  â”œâ”€â”€ new CuigeService(...)           # å´”å“¥æœåŠ¡                      â”‚
â”‚  â”œâ”€â”€ new RagController(...)          # RAG æ§åˆ¶å™¨                    â”‚
â”‚  â”œâ”€â”€ new CuigeController(...)        # å´”å“¥æ§åˆ¶å™¨                    â”‚
â”‚  â””â”€â”€ $router->get/post(path, [ctrl, method])                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  src/Bootstrap/Router.php                                            â”‚
â”‚  â”œâ”€â”€ dispatch(Request): Response                                     â”‚
â”‚  â”œâ”€â”€ è·¯ç”±åŒ¹é… (æ”¯æŒ RESTful å‚æ•°)                                     â”‚
â”‚  â””â”€â”€ callHandler() # æ”¯æŒ 3 ç§æ¨¡å¼                                   â”‚
â”‚      â”œâ”€â”€ Case 1: Closure                                             â”‚
â”‚      â”œâ”€â”€ Case 2: [å¯¹è±¡å®ä¾‹, æ–¹æ³•] âœ… æ¨è                             â”‚
â”‚      â””â”€â”€ Case 3: [ç±»å, æ–¹æ³•] âš ï¸ æ— ä¾èµ–åœºæ™¯                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  src/Controllers/*Controller.php                                     â”‚
â”‚  â”œâ”€â”€ æ„é€ å‡½æ•°æ¥æ”¶ä¾èµ–æ³¨å…¥                                             â”‚
â”‚  â”œâ”€â”€ æ–¹æ³•ç­¾å: method(Request, array $params): Response              â”‚
â”‚  â””â”€â”€ è°ƒç”¨ Service å¤„ç†ä¸šåŠ¡ï¼Œè¿”å› Response                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  src/Services/AI/*Service.php                                        â”‚
â”‚  â”œâ”€â”€ ä¸šåŠ¡é€»è¾‘å¤„ç†                                                     â”‚
â”‚  â”œâ”€â”€ è°ƒç”¨ Repository æ•°æ®è®¿é—®                                        â”‚
â”‚  â”œâ”€â”€ è°ƒç”¨ ModelRouter AI æ¨¡å‹                                        â”‚
â”‚  â””â”€â”€ è¿”å›å¤„ç†ç»“æœ                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2. æ§åˆ¶å™¨ä¾èµ–å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Controllers                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                    â”‚                    â”‚
        â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚CuigeControllerâ”‚  â”‚ RagController â”‚  â”‚DebateControllerâ”‚
â”‚ âœ… å®Œå…¨åˆè§„   â”‚  â”‚ âœ… å®Œå…¨åˆè§„   â”‚  â”‚ âŒ æœ‰è¿è§„     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                    â”‚                    â”‚
        â”‚                    â”‚                    â”‚
        â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¾èµ–æ³¨å…¥:     â”‚  â”‚ ä¾èµ–æ³¨å…¥:     â”‚  â”‚ ç¼ºå¤±ä¾èµ–æ³¨å…¥: â”‚
â”‚ - CuigeServiceâ”‚  â”‚ - VectorServiceâ”‚ â”‚ âŒ new Serviceâ”‚
â”‚ - CuigeConfig â”‚  â”‚ - DocProcessor â”‚  â”‚ âŒ new Analyzerâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3. æœåŠ¡å±‚ä¾èµ–å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Services/AI/Bootstrap.php                    â”‚
â”‚                        (å…¨å±€æœåŠ¡å·¥å‚)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  getPDO()          â†’ MySQL PDO (å•ä¾‹)                           â”‚
â”‚  getPgPdo()        â†’ PostgreSQL PDO (å•ä¾‹)                      â”‚
â”‚  getModelRouter()  â†’ ModelRouter (å•ä¾‹)                         â”‚
â”‚  getAIManager()    â†’ AIManager (å•ä¾‹)                           â”‚
â”‚  getToolRegistry() â†’ ToolRegistry (å•ä¾‹)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                     â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CuigeService â”‚     â”‚ VectorService â”‚     â”‚  ModelRouter  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ä¾èµ–:         â”‚     â”‚ ä¾èµ–:         â”‚     â”‚ ä¾èµ–:         â”‚
â”‚ - Repository  â”‚     â”‚ - PDO (pg)    â”‚     â”‚ - Providers[] â”‚
â”‚ - ModelRouter â”‚     â”‚ - Embedding   â”‚     â”‚ - Config      â”‚
â”‚ - CuigeConfig â”‚     â”‚ - Chunker     â”‚     â”‚               â”‚
â”‚ - VectorServiceâ”‚    â”‚               â”‚     â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                     â”‚                     â”‚
        â–¼                     â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚CuigeRepositoryâ”‚     â”‚LocalEmbedding â”‚     â”‚DeepseekProviderâ”‚
â”‚               â”‚     â”‚DocumentChunkerâ”‚     â”‚OpenAIProvider  â”‚
â”‚               â”‚     â”‚               â”‚     â”‚RelayProvider   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš¦ CFC V7.7 åˆè§„æ£€æŸ¥

### âœ… åˆè§„æ–‡ä»¶åˆ—è¡¨

| æ–‡ä»¶ | å±‚çº§ | åˆè§„è¯´æ˜ |
|------|------|----------|
| `public/index.php` | å…¥å£ | å”¯ä¸€ HTTP å…¥å£ï¼Œç¬¦åˆè§„èŒƒ |
| `src/Bootstrap/App.php` | å¯åŠ¨ | æ¡†æ¶å¯åŠ¨å™¨ï¼ŒèŒè´£å•ä¸€ |
| `src/Bootstrap/Router.php` | å¯åŠ¨ | RESTful è·¯ç”±ï¼Œæ”¯æŒ DI |
| `src/Bootstrap/routes.php` | å¯åŠ¨ | IoC å®¹å™¨ï¼Œæ­£ç¡®ç»„è£…ä¾èµ– |
| `src/Core/Request.php` | æ ¸å¿ƒ | HTTP è¯·æ±‚å°è£… |
| `src/Core/Response.php` | æ ¸å¿ƒ | HTTP å“åº”å°è£… |
| `src/Controllers/CuigeController.php` | æ§åˆ¶å™¨ | å®Œç¾ DI + è´«è¡€æ¨¡å¼ |
| `src/Controllers/RagController.php` | æ§åˆ¶å™¨ | å®Œç¾ DI + è´«è¡€æ¨¡å¼ |
| `src/Controllers/SystemController.php` | æ§åˆ¶å™¨ | æ— ä¾èµ–ç®€å•æ§åˆ¶å™¨ |

### âŒ è¿è§„æ–‡ä»¶åˆ—è¡¨

| æ–‡ä»¶ | è¿è§„ç±»å‹ | ä¸¥é‡ç¨‹åº¦ | é—®é¢˜æè¿° |
|------|----------|----------|----------|
| `src/Controllers/DebateController.php` | è§„åˆ™3 | ğŸš¨ ä¸¥é‡ | `new DebateService($mode)` æ–¹æ³•å†…å®ä¾‹åŒ– |
| `src/Controllers/DebateController.php` | è§„åˆ™3 | ğŸš¨ ä¸¥é‡ | `new ImageAnalyzer()` æ–¹æ³•å†…å®ä¾‹åŒ– |
| `src/Controllers/DebateController.php` | è§„åˆ™6 | âš ï¸ ä¸­ç­‰ | åŒ…å«ç§æœ‰ä¸šåŠ¡æ–¹æ³• |
| `src/Bootstrap/migrate.php` | è§„åˆ™2 | âš ï¸ ä¸­ç­‰ | `new PDO()` (CLIå·¥å…·å¯è±å…) |
| `src/Services/AI/Core/SSEResponse.php` | è§„åˆ™4 | âš ï¸ ä¸­ç­‰ | `header()` (æ¡†æ¶å±‚å¯æ¥å—) |

---

## ğŸ“‹ æœåŠ¡å±‚è¯¦ç»†ä¾èµ–åˆ†æ

### CuigeService (å´”å“¥ AI æœåŠ¡)

**æ–‡ä»¶**: `src/Services/AI/Cuige/CuigeService.php`  
**è¡Œæ•°**: 660 è¡Œ  
**åˆè§„çŠ¶æ€**: âœ… å®Œå…¨åˆè§„

```
ä¾èµ–æ³¨å…¥å›¾:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CuigeService                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ„é€ å‡½æ•°å‚æ•° (å…¨éƒ¨é€šè¿‡ DI):                                      â”‚
â”‚  â”œâ”€â”€ CuigeRepository $repository    # æ•°æ®è®¿é—®å±‚                  â”‚
â”‚  â”œâ”€â”€ ModelRouter $modelRouter       # AI æ¨¡å‹è·¯ç”±                 â”‚
â”‚  â”œâ”€â”€ CuigeConfig $config            # é…ç½®ç®¡ç†                    â”‚
â”‚  â””â”€â”€ ?VectorService $vectorService  # RAG å‘é‡æœåŠ¡ (å¯é€‰)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä¸»è¦æ–¹æ³•:                                                        â”‚
â”‚  â”œâ”€â”€ chat(message, sessionId, userId): array                     â”‚
â”‚  â”œâ”€â”€ streamChat(message, sessionId, userId, callback): array     â”‚
â”‚  â”œâ”€â”€ buildContext(userId, sessionId, message): array             â”‚
â”‚  â”œâ”€â”€ compressMemory(sessionId, userId, messages): array          â”‚
â”‚  â””â”€â”€ extractKeyInfo(userId, message): void                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ è°ƒç”¨
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CuigeRepository                                                  â”‚
â”‚  â”œâ”€â”€ ensureSession()        # ç¡®ä¿ä¼šè¯å­˜åœ¨                        â”‚
â”‚  â”œâ”€â”€ saveShortMemory()      # ä¿å­˜çŸ­æœŸè®°å¿†                        â”‚
â”‚  â”œâ”€â”€ getShortMemory()       # è·å–çŸ­æœŸè®°å¿†                        â”‚
â”‚  â”œâ”€â”€ getLongMemory()        # è·å–é•¿æœŸè®°å¿†                        â”‚
â”‚  â””â”€â”€ getUserProfile()       # è·å–ç”¨æˆ·ç”»åƒ                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### VectorService (RAG å‘é‡æœåŠ¡)

**æ–‡ä»¶**: `src/Services/AI/Core/RAG/VectorService.php`  
**è¡Œæ•°**: 464 è¡Œ  
**åˆè§„çŠ¶æ€**: âœ… å®Œå…¨åˆè§„

```
ä¾èµ–æ³¨å…¥å›¾:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      VectorService                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ„é€ å‡½æ•°å‚æ•° (å…¨éƒ¨é€šè¿‡ DI):                                      â”‚
â”‚  â”œâ”€â”€ PDO $pdo                       # æ•°æ®åº“è¿æ¥ (PostgreSQL)     â”‚
â”‚  â”œâ”€â”€ ?EmbeddingProvider $embedding  # åµŒå…¥æœåŠ¡æä¾›è€… (å¯é€‰)       â”‚
â”‚  â”œâ”€â”€ int $chunkSize = 512           # åˆ†å—å¤§å°                    â”‚
â”‚  â”œâ”€â”€ int $chunkOverlap = 50         # é‡å å¤§å°                    â”‚
â”‚  â”œâ”€â”€ string $backend = 'mysql'      # åç«¯ç±»å‹                    â”‚
â”‚  â””â”€â”€ bool $forceLocalEmbedding      # å¼ºåˆ¶æœ¬åœ°åµŒå…¥                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å†…éƒ¨åˆ›å»º (æ¡†æ¶å…è®¸):                                             â”‚
â”‚  â””â”€â”€ LocalEmbedding (æœ¬åœ°åµŒå…¥é™çº§æ–¹æ¡ˆ)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä¸»è¦æ–¹æ³•:                                                        â”‚
â”‚  â”œâ”€â”€ processFile(filePath, fileName): array   # å¤„ç†æ–‡ä»¶          â”‚
â”‚  â”œâ”€â”€ search(query, topK): array               # å‘é‡æœç´¢          â”‚
â”‚  â”œâ”€â”€ deleteByHash(hash): bool                 # åˆ é™¤æ–‡æ¡£          â”‚
â”‚  â”œâ”€â”€ getStats(): array                        # ç»Ÿè®¡ä¿¡æ¯          â”‚
â”‚  â””â”€â”€ listDocuments(): array                   # æ–‡æ¡£åˆ—è¡¨          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### DebateService (è¾©è®ºæœåŠ¡)

**æ–‡ä»¶**: `src/Services/AI/Debate/DebateService.php`  
**è¡Œæ•°**: 218 è¡Œ  
**åˆè§„çŠ¶æ€**: âš ï¸ æœ‰æ”¹è¿›ç©ºé—´

```
å½“å‰å®ç°å›¾:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DebateService                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ„é€ å‡½æ•°å‚æ•°:                                                    â”‚
â”‚  â””â”€â”€ string $mode = 'chat'          # ä»…æ¥æ”¶æ¨¡å¼å‚æ•°              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å†…éƒ¨åˆå§‹åŒ– (âš ï¸ è¿åæœ€ä½³å®è·µ):                                    â”‚
â”‚  â”œâ”€â”€ Bootstrap::initialize()        # æ‰‹åŠ¨åˆå§‹åŒ–                  â”‚
â”‚  â”œâ”€â”€ Bootstrap::getModelRouter()    # ä»å…¨å±€è·å–                  â”‚
â”‚  â””â”€â”€ new DebateAgent(...)           # å†…éƒ¨å®ä¾‹åŒ–                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä¸»è¦æ–¹æ³•:                                                        â”‚
â”‚  â”œâ”€â”€ run(topic): void               # è¿è¡Œè¾©è®º                    â”‚
â”‚  â”œâ”€â”€ loadConfig(): void             # åŠ è½½é…ç½®                    â”‚
â”‚  â””â”€â”€ initializeComponents(): void   # åˆå§‹åŒ–ç»„ä»¶                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âš ï¸ æ”¹è¿›å»ºè®®:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¨èæ„é€ å‡½æ•°:                                                    â”‚
â”‚  public function __construct(                                     â”‚
â”‚      ModelRouter $router,           # é€šè¿‡ DI æ³¨å…¥                â”‚
â”‚      DebateAgent $agent,            # é€šè¿‡ DI æ³¨å…¥                â”‚
â”‚      array $config,                 # é…ç½®é€šè¿‡ DI æ³¨å…¥            â”‚
â”‚      string $mode = 'chat'                                        â”‚
â”‚  )                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ImageAnalyzer (å›¾ç‰‡åˆ†ææœåŠ¡)

**æ–‡ä»¶**: `src/Services/AI/Vision/ImageAnalyzer.php`  
**è¡Œæ•°**: 289 è¡Œ  
**åˆè§„çŠ¶æ€**: âš ï¸ æœ‰æ”¹è¿›ç©ºé—´

```
å½“å‰å®ç°å›¾:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ImageAnalyzer                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ„é€ å‡½æ•°:                                                        â”‚
â”‚  â””â”€â”€ æ— å‚æ•°æ„é€                      # âš ï¸ æ— ä¾èµ–æ³¨å…¥               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å†…éƒ¨åˆå§‹åŒ– (âš ï¸ è¿å CFC è§„èŒƒ):                                   â”‚
â”‚  â”œâ”€â”€ Bootstrap::initialize()        # æ‰‹åŠ¨åˆå§‹åŒ–                  â”‚
â”‚  â””â”€â”€ Config::get(...)               # ç›´æ¥è¯»å–é…ç½®                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä¸»è¦æ–¹æ³•:                                                        â”‚
â”‚  â”œâ”€â”€ analyzeUpload(file): array     # åˆ†æä¸Šä¼ å›¾ç‰‡                â”‚
â”‚  â”œâ”€â”€ analyze(filePath): array       # åˆ†ææœ¬åœ°å›¾ç‰‡                â”‚
â”‚  â””â”€â”€ callVisionAPI(base64): array   # è°ƒç”¨è§†è§‰ API                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âš ï¸ æ”¹è¿›å»ºè®®:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¨èæ„é€ å‡½æ•°:                                                    â”‚
â”‚  public function __construct(                                     â”‚
â”‚      string $apiKey,                # é€šè¿‡ DI æ³¨å…¥                â”‚
â”‚      string $baseUrl,               # é€šè¿‡ DI æ³¨å…¥                â”‚
â”‚      string $model                  # é€šè¿‡ DI æ³¨å…¥                â”‚
â”‚  )                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ModelRouter (æ¨¡å‹è·¯ç”±å™¨)

**æ–‡ä»¶**: `src/Services/AI/Core/ModelRouter.php`  
**è¡Œæ•°**: 172 è¡Œ  
**åˆè§„çŠ¶æ€**: âœ… å®Œå…¨åˆè§„

```
ä¾èµ–å›¾:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ModelRouter                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ³¨å†Œæ–¹æ³• (ä¾èµ–å¤–éƒ¨æ³¨å…¥):                                         â”‚
â”‚  â”œâ”€â”€ register(name, provider)       # æ³¨å†Œå•ä¸ª Provider          â”‚
â”‚  â””â”€â”€ registerMany(providers)        # æ‰¹é‡æ³¨å†Œ                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è·¯ç”±æ–¹æ³•:                                                        â”‚
â”‚  â”œâ”€â”€ route(model): Provider         # æ ¹æ®æ¨¡å‹åè·¯ç”±              â”‚
â”‚  â”œâ”€â”€ getProvider(name): Provider    # æŒ‰åç§°è·å–                  â”‚
â”‚  â””â”€â”€ chat(model, messages, opts)    # ä¾¿æ·èŠå¤©æ–¹æ³•                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å·²æ³¨å†Œ Providers:                                                â”‚
â”‚  â”œâ”€â”€ DeepseekProvider               # DeepSeek AI                 â”‚
â”‚  â”œâ”€â”€ OpenAIProvider                 # OpenAI / å…¼å®¹ API           â”‚
â”‚  â””â”€â”€ RelayProvider                  # ä¸­ç»§ä»£ç†                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”´ CFC ä¸ƒå®—ç½ªè¿è§„è¯¦æƒ…

### è¿è§„ 1: ç‹¬ç«‹å…¥å£ (å…¬å…±ç›®å½•ä»¥å¤–çš„ PHP æ–‡ä»¶)

| æ‰«æä½ç½® | å‘ç° | çŠ¶æ€ |
|----------|------|------|
| `public/index.php` | å”¯ä¸€åˆæ³•å…¥å£ | âœ… |
| `public/*.php` | ä»… index.php | âœ… |
| `tests/*.php` | æµ‹è¯•æ–‡ä»¶ | âš ï¸ è±å… |
| `workers/*.php` | Worker è„šæœ¬ | âš ï¸ è±å… |
| `examples/*.php` | ç¤ºä¾‹è„šæœ¬ | âš ï¸ è±å… |

**ç»“è®º**: âœ… æ— è¿è§„ (æµ‹è¯•/ç¤ºä¾‹/Worker æŒ‰è§„èŒƒè±å…)

---

### è¿è§„ 2: ç§å»ºæ•°æ®åº“è¿æ¥

| æ–‡ä»¶ | è¡Œå· | ä»£ç  | çŠ¶æ€ |
|------|------|------|------|
| `src/Bootstrap/migrate.php` | 82 | `new PDO(...)` | âš ï¸ CLI å·¥å…· |
| `src/Services/AI/Bootstrap.php` | - | `new PDO(...)` | âœ… å·¥å‚æ–¹æ³• |

**ç»“è®º**: âš ï¸ 1 å¤„è­¦å‘Š (migrate.php æ˜¯ CLI å·¥å…·ï¼Œå¯è±å…)

---

### è¿è§„ 3: æ–¹æ³•å†…ç›´æ¥ new Service

| æ–‡ä»¶ | è¡Œå· | ä»£ç  | çŠ¶æ€ |
|------|------|------|------|
| `DebateController.php` | 49 | `new DebateService($mode)` | âŒ ä¸¥é‡ |
| `DebateController.php` | 199 | `new DebateService($mode)` | âŒ ä¸¥é‡ |
| `DebateController.php` | 126 | `new ImageAnalyzer()` | âŒ ä¸¥é‡ |
| `DebateController.php` | 170 | `new ImageAnalyzer()` | âŒ ä¸¥é‡ |

**ç»“è®º**: âŒ 4 å¤„ä¸¥é‡è¿è§„

---

### è¿è§„ 4: åŸç”Ÿè¾“å‡º

| æ–‡ä»¶ | è¡Œå· | ä»£ç  | çŠ¶æ€ |
|------|------|------|------|
| `SSEResponse.php` | 29-32 | `header(...)` | âš ï¸ æ¡†æ¶å±‚ |
| `migrate.php` | 44,96,110,139 | `exit(...)` | âš ï¸ CLI |

**ç»“è®º**: âš ï¸ æ¡†æ¶å±‚å’Œ CLI å¯æ¥å—

---

### è¿è§„ 5: Controller è¯»é…ç½®

**æ‰«æç»“æœ**: âœ… æœªå‘ç°è¿è§„

Controller å±‚æœªå‘ç° `getenv()` æˆ–ç›´æ¥è¯»å– `$_ENV`

---

### è¿è§„ 6: Controller åŒ…å«ä¸šåŠ¡é€»è¾‘

| æ–‡ä»¶ | æ–¹æ³• | é—®é¢˜ | çŠ¶æ€ |
|------|------|------|------|
| `DebateController.php` | `buildImageContext()` | ç§æœ‰ä¸šåŠ¡æ–¹æ³• | âš ï¸ |
| `DebateController.php` | `buildCombinedTopic()` | ç§æœ‰ä¸šåŠ¡æ–¹æ³• | âš ï¸ |
| `DebateController.php` | `streamWithImage()` | è¶…è¿‡ 50 è¡Œ | âš ï¸ |

**ç»“è®º**: âš ï¸ 2 å¤„è­¦å‘Š

---

### è¿è§„ 7: ç¡¬ç¼–ç 

**æ‰«æç»“æœ**: âœ… æœªå‘ç°è¿è§„

æœªå‘ç°ç¡¬ç¼–ç çš„ SQLã€URL æˆ–å‡­è¯

---

## ğŸ“Š åˆè§„è¯„åˆ†æ€»ç»“

| è§„åˆ™ | æƒé‡ | å¾—åˆ† | çŠ¶æ€ |
|------|------|------|------|
| 1. ç¦æ­¢ç‹¬ç«‹å…¥å£ | 20% | 20/20 | âœ… |
| 2. ç¦æ­¢ç§å»ºè¿æ¥ | 15% | 12/15 | âš ï¸ |
| 3. ç¦æ­¢ç›´æ¥ new | 20% | 10/20 | âŒ |
| 4. ç¦æ­¢åŸç”Ÿè¾“å‡º | 15% | 12/15 | âš ï¸ |
| 5. ç¦æ­¢è¯»é…ç½® | 10% | 10/10 | âœ… |
| 6. Controller è´«è¡€ | 10% | 6/10 | âš ï¸ |
| 7. ç¦æ­¢ç¡¬ç¼–ç  | 10% | 10/10 | âœ… |

**æ€»åˆ†: 80/100**

---

## ğŸ”§ ä¿®å¤ä¼˜å…ˆçº§

### P0 - å¿…é¡»ç«‹å³ä¿®å¤

```php
// âŒ å½“å‰ DebateController (è¿è§„)
public function stream(Request $request, array $params): Response
{
    $service = new DebateService($mode);  // è¿è§„!
    ...
}

// âœ… ä¿®å¤æ–¹æ¡ˆ 1: æ„é€ å‡½æ•°æ³¨å…¥
class DebateController
{
    public function __construct(
        protected DebateService $debateService,
        protected ImageAnalyzer $imageAnalyzer
    ) {}
}

// âœ… ä¿®å¤æ–¹æ¡ˆ 2: å·¥å‚æ¨¡å¼ (å¤„ç†åŠ¨æ€ $mode)
class DebateController
{
    public function __construct(
        protected DebateServiceFactory $factory
    ) {}
    
    public function stream(Request $request, array $params): Response
    {
        $service = $this->factory->create($mode);
        ...
    }
}
```

### P1 - æœ¬å‘¨ä¿®å¤

1. å°† `buildImageContext()` ç§»è‡³ `ImageAnalyzer::formatContext()`
2. å°† `buildCombinedTopic()` ç§»è‡³ `DebateService::buildTopic()`

### P2 - æŒç»­ä¼˜åŒ–

1. é‡æ„ `DebateService` æ”¯æŒæ„é€ å‡½æ•°æ³¨å…¥
2. é‡æ„ `ImageAnalyzer` æ”¯æŒé…ç½®æ³¨å…¥

---

*ğŸ“„ æŠ¥å‘Šå®Œæˆ*

**æ‰«æç»Ÿè®¡**:
- ç›®å½•æ•°: 28
- PHP æ–‡ä»¶æ•°: 128
- æºç æ–‡ä»¶: 73
- ä»£ç è¡Œæ•°: ~15,000

**æŠ¥å‘Šç”Ÿæˆ**: GitHub Copilot  
**æ¡†æ¶ç‰ˆæœ¬**: CFC V7.7  
**å®¡è®¡æ—¥æœŸ**: 2025-12-13
